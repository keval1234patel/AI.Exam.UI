<ng-container *ngIf="question">

  <mat-card class="p-4 h-100" style="min-height: 500px;">

    <!-- ================= HEADER ================= -->
    <div class="d-flex justify-content-between align-items-center pb-3 mb-3 border-bottom">

      <!-- Question Type Badge -->
      <span class="badge bg-primary d-flex align-items-center px-3 py-2 text-uppercase">
        <mat-icon class="me-2">
          {{ question.questionType === 'CW' ? 'code' :
             question.questionType === 'COP' ? 'terminal' :
            'help' }}
        </mat-icon>

        {{ typeLabels[question.questionType] || question.questionType }}
      </span>

      <!-- Correct / Incorrect Badge -->
      <ng-container *ngIf="isVerified">
        <span
          class="badge px-3 py-2 d-flex align-items-center"
          [ngClass]="isAnswerCorrect ? 'bg-success text-light' : 'bg-danger text-light'"
        >
          <mat-icon class="me-2">
            {{ isAnswerCorrect ? 'check' : 'close' }}
          </mat-icon>
          {{ isAnswerCorrect ? 'Correct' : 'Incorrect' }}
        </span>
      </ng-container>

    </div>

    <!-- ================= QUESTION TEXT ================= -->
    <div class="mb-4">

      <!-- Code-style question -->
      <pre *ngIf="isCodeType"
           class="p-3 bg-light border rounded"
           style="font-family: monospace; white-space: pre-wrap;">
{{ question.q }}
      </pre>

      <!-- Normal question -->
      <h5 *ngIf="!isCodeType" class="fw-semibold">
        {{ question.q }}
      </h5>

    </div>

    <!-- ================== OPTIONS ================== -->
    <div *ngIf="question.options || question.questionType === 'TF'; else textAnswerView">

      <h6 class="text-secondary text-uppercase small fw-bold mb-2">Options</h6>

      <div class="row g-3">

        <div
          class="col-12"
          *ngFor="let opt of displayOptions"
        >
          <div
            class="p-3 border rounded d-flex justify-content-between align-items-center"
            [ngClass]="getOptionClass(opt)"
            style="background: #fafafa;"
          >
            <span class="fw-semibold">{{ opt }}</span>

            <!-- Icon / Status -->
            <ng-container *ngIf="getOptionIcon(opt) as iconStatus">

              <span class="d-flex align-items-center">

                <!-- Correct Choice -->
                <ng-container *ngIf="iconStatus === 'correct-choice'">
                  <mat-icon class="text-success me-1">check</mat-icon>
                  <small class="fw-bold text-success">Your Answer</small>
                </ng-container>

                <!-- Missed Correct -->
                <ng-container *ngIf="iconStatus === 'missed'">
                  <mat-icon class="text-success me-1">check</mat-icon>
                  <small class="fw-bold text-success">Correct Answer</small>
                </ng-container>

                <!-- Wrong -->
                <ng-container *ngIf="iconStatus === 'wrong'">
                  <mat-icon class="text-danger me-1">close</mat-icon>
                  <small class="fw-bold text-danger">Your Answer</small>
                </ng-container>

              </span>

            </ng-container>
          </div>
        </div>

      </div>

    </div>

    <!-- ================== TEXT ANSWER MODE ================== -->
    <ng-template #textAnswerView>

      <div class="row g-4 mt-1">

        <!-- YOUR ANSWER -->
        <div class="col-md-6">
          <h6 class="text-danger fw-bold text-uppercase small mb-2 d-flex align-items-center">
            <mat-icon class="me-2">close</mat-icon>
            Your Answer
          </h6>

          <div
            class="p-3 border rounded"
            [ngClass]="isCodeType 
              ? 'bg-dark text-light'
              : 'bg-danger bg-opacity-10 text-dark'"
            style="white-space: pre-wrap;"
          >
            {{ question.studentAnswer || 'No answer provided' }}
          </div>
        </div>

        <!-- CORRECT ANSWER -->
        <div class="col-md-6">
          <h6 class="text-success fw-bold text-uppercase small mb-2 d-flex align-items-center">
            <mat-icon class="me-2">check</mat-icon>
            Correct Answer
          </h6>

          <div
            class="p-3 border rounded"
            [ngClass]="isCodeType 
              ? 'bg-secondary text-success'
              : 'bg-success bg-opacity-10 text-dark'"
            style="white-space: pre-wrap;"
          >
            {{ question.a }}
          </div>
        </div>

      </div>

    </ng-template>

    <!-- ================== FOOTER ================== -->
    <div class="mt-4 pt-3 border-top">

      <div class="d-flex align-items-center p-3 bg-light rounded border">

        <mat-icon class="me-2 text-secondary">error_outline</mat-icon>

        <span class="text-secondary">
          Score: 
          <span class="fw-bold text-dark">{{ question.score }}</span>
        </span>

      </div>
    </div>

  </mat-card>

</ng-container>
<ng-container *ngIf="!question">
  <div
    class="d-flex align-items-center justify-content-center h-100 bg-white rounded-lg shadow text-secondary"
    style="min-height: 500px;"
  >
    Select a question to view details
  </div>